{% comment %} {{ 'component-countdown-timer.css' | asset_url | stylesheet_tag }} {% endcomment %}

{% style %}
  .black-friday-countdown-{{ section.id }} {
    position: relative;
    min-height: 500px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: {{ section.settings.section_padding_top }}px {{ section.settings.section_padding_right }}px {{ section.settings.section_padding_bottom }}px {{ section.settings.section_padding_left }}px;
    margin: {{ section.settings.section_margin_top }}px {{ section.settings.section_margin_right }}px {{ section.settings.section_margin_bottom }}px {{ section.settings.section_margin_left }}px;
    overflow: hidden;
  }
  
  .black-friday-countdown-{{ section.id }}::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, {{ section.settings.overlay_opacity | divided_by: 100.0 }});
    z-index: 1;
  }
  
  .black-friday-countdown__bg-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: {{ section.settings.image_fit }};
    object-position: {{ section.settings.image_position }};
  }
  
  .black-friday-countdown__content {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 40px;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
    color: #d7b2b2;
    text-align: center;
  }
  
  .black-friday-countdown__text-content {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
  }
  
  .black-friday-countdown__main-heading {
    font-size: {{ section.settings.main_heading_font_size }}px;
    font-weight: {{ section.settings.main_heading_font_weight }};
    margin: 0 0 20px 0;
    line-height: 1.1;
    letter-spacing: {{ section.settings.main_heading_letter_spacing }}px;
    text-transform: {{ section.settings.main_heading_text_transform }};
    color: #d7b2b2;
  }
  
  .black-friday-countdown__subheading {
    font-size: {{ section.settings.subheading_font_size }}px;
    font-weight: {{ section.settings.subheading_font_weight }};
    margin: 0;
    line-height: 1.3;
    letter-spacing: {{ section.settings.subheading_letter_spacing }}px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    color: #d7b2b2;
  }
  
  .black-friday-countdown__timer {
    display: flex;
    justify-content: center;
    gap: 0;
    margin-top: 20px;
  }
  
  .black-friday-countdown__timer-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 30px;
    position: relative;
  }
  
  .black-friday-countdown__timer-item:not(:last-child)::after {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    height: 60%;
    width: {{ section.settings.timer_border_width }}px;
    background-color: rgba(215, 178, 178, 0.3);
  }
  
  .black-friday-countdown__timer-number {
    font-size: {{ section.settings.timer_number_font_size }}px;
    font-weight: {{ section.settings.timer_number_font_weight }};
    line-height: 1;
    margin-bottom: 8px;
    font-family: {{ section.settings.timer_font_family }};
    color: #d7b2b2;
  }
  
  .black-friday-countdown__timer-label {
    font-size: 13px;
    font-weight: {{ section.settings.timer_label_font_weight }};
    letter-spacing: {{ section.settings.timer_label_letter_spacing }}px;
    text-transform: uppercase;
    color: #d7b2b2;
  }
  
  @media (max-width: 768px) {
    .black-friday-countdown-{{ section.id }} {
      min-height: 400px;
    }
    
    .black-friday-countdown__content {
      gap: 30px;
    }
    
    .black-friday-countdown__main-heading {
      font-size: {{ section.settings.main_heading_font_size_mobile }}px;
    }
    
    .black-friday-countdown__subheading {
      font-size: {{ section.settings.subheading_font_size_mobile }}px;
    }
    
    .black-friday-countdown__timer {
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    
    .black-friday-countdown__timer-item {
      padding: 0 15px;
    }
    
    .black-friday-countdown__timer-item:not(:last-child)::after {
      display: none;
    }
    
    .black-friday-countdown__timer-number {
      font-size: {{ section.settings.timer_number_font_size_mobile }}px;
    }
    
    .black-friday-countdown__timer-label {
      font-size: 12px;
    }
  }
  
  @media (max-width: 480px) {
    .black-friday-countdown__timer {
      gap: 10px;
    }
    
    .black-friday-countdown__timer-item {
      padding: 0 10px;
    }
    
    .black-friday-countdown__timer-number {
      font-size: {{ section.settings.timer_number_font_size_mobile | minus: 8 }}px;
    }
    
    .black-friday-countdown__timer-label {
      font-size: 11px;
    }
  }
{% endstyle %}

<div class="black-friday-countdown black-friday-countdown-{{ section.id }}">
  {% if section.settings.background_image %}
    <img 
      src="{{ section.settings.background_image | image_url: width: 2000 }}" 
      alt="{{ section.settings.background_image.alt | escape }}" 
      class="black-friday-countdown__bg-image"
      loading="lazy"
      width="2000"
      height="{{ 2000 | divided_by: section.settings.background_image.aspect_ratio | round }}"
    >
  {% else %}
    <div class="black-friday-countdown__bg-image placeholder-background">
      {{ 'lifestyle-2' | placeholder_svg_tag: 'placeholder-svg' }}
    </div>
  {% endif %}
  
  <div class="black-friday-countdown__content">
    <div class="black-friday-countdown__text-content">
      <h2 class="black-friday-countdown__main-heading">
        {{ section.settings.main_heading }}
      </h2>
      <p class="black-friday-countdown__subheading">
        {{ section.settings.subheading }}
      </p>
    </div>
    
    <div class="black-friday-countdown__timer">
      <div class="black-friday-countdown__timer-item">
        <div class="black-friday-countdown__timer-number" data-days>
          00
        </div>
        <div class="black-friday-countdown__timer-label">
          {{ section.settings.days_label }}
        </div>
      </div>
      
      <div class="black-friday-countdown__timer-item">
        <div class="black-friday-countdown__timer-number" data-hours>
          00
        </div>
        <div class="black-friday-countdown__timer-label">
          {{ section.settings.hours_label }}
        </div>
      </div>
      
      <div class="black-friday-countdown__timer-item">
        <div class="black-friday-countdown__timer-number" data-minutes>
          00
        </div>
        <div class="black-friday-countdown__timer-label">
          {{ section.settings.minutes_label }}
        </div>
      </div>
      
      <div class="black-friday-countdown__timer-item">
        <div class="black-friday-countdown__timer-number" data-seconds>
          00
        </div>
        <div class="black-friday-countdown__timer-label">
          {{ section.settings.seconds_label }}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    function parseCountdownDate(dateString) {
      // Try to parse the date string with validation
      const date = new Date(dateString);
      
      // If the date is invalid, provide fallback
      if (isNaN(date.getTime())) {
        console.error('Invalid date format. Using fallback date.');
        // Fallback to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        return tomorrow.getTime();
      }
      
      return date.getTime();
    }
    
    const countdownDate = parseCountdownDate("{{ section.settings.countdown_date }}");
    
    function updateCountdown() {
      const now = new Date().getTime();
      const distance = countdownDate - now;
      
      if (distance < 0) {
        document.querySelector('[data-days]').textContent = '00';
        document.querySelector('[data-hours]').textContent = '00';
        document.querySelector('[data-minutes]').textContent = '00';
        document.querySelector('[data-seconds]').textContent = '00';
        return;
      }
      
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      
      document.querySelector('[data-days]').textContent = days.toString().padStart(2, '0');
      document.querySelector('[data-hours]').textContent = hours.toString().padStart(2, '0');
      document.querySelector('[data-minutes]').textContent = minutes.toString().padStart(2, '0');
      document.querySelector('[data-seconds]').textContent = seconds.toString().padStart(2, '0');
    }
    
    updateCountdown();
    setInterval(updateCountdown, 1000);
  });
</script>

{% schema %}
{
  "name": "Black Friday Countdown",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Background Settings"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image",
      "info": "Recommended size: 2000x1000px"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Dark Overlay Opacity",
      "default": 40,
      "info": "Dark overlay is always visible (not on hover)"
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Image Fit",
      "options": [
        {
          "value": "cover",
          "label": "Cover"
        },
        {
          "value": "contain",
          "label": "Contain"
        }
      ],
      "default": "cover"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Image Position",
      "options": [
        {
          "value": "center center",
          "label": "Center"
        },
        {
          "value": "top left",
          "label": "Top Left"
        },
        {
          "value": "top center",
          "label": "Top Center"
        },
        {
          "value": "top right",
          "label": "Top Right"
        },
        {
          "value": "center left",
          "label": "Center Left"
        },
        {
          "value": "center right",
          "label": "Center Right"
        },
        {
          "value": "bottom left",
          "label": "Bottom Left"
        },
        {
          "value": "bottom center",
          "label": "Bottom Center"
        },
        {
          "value": "bottom right",
          "label": "Bottom Right"
        }
      ],
      "default": "center center"
    },
    {
      "type": "header",
      "content": "Text Content"
    },
    {
      "type": "text",
      "id": "main_heading",
      "label": "Main Heading",
      "default": "BLACK FRIDAY"
    },
    {
      "type": "range",
      "id": "main_heading_font_size",
      "min": 20,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Main Heading Font Size",
      "default": 64
    },
    {
      "type": "range",
      "id": "main_heading_font_size_mobile",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Main Heading Font Size (Mobile)",
      "default": 42
    },
    {
      "type": "range",
      "id": "main_heading_font_weight",
      "min": 100,
      "max": 900,
      "step": 100,
      "label": "Main Heading Font Weight",
      "default": 700
    },
    {
      "type": "range",
      "id": "main_heading_letter_spacing",
      "min": 0,
      "max": 10,
      "step": 0.5,
      "unit": "px",
      "label": "Main Heading Letter Spacing",
      "default": 2
    },
    {
      "type": "select",
      "id": "main_heading_text_transform",
      "label": "Main Heading Text Transform",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "uppercase",
          "label": "Uppercase"
        },
        {
          "value": "lowercase",
          "label": "Lowercase"
        },
        {
          "value": "capitalize",
          "label": "Capitalize"
        }
      ],
      "default": "uppercase"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "get 20% off if you spend 120$ or more!"
    },
    {
      "type": "range",
      "id": "subheading_font_size",
      "min": 12,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Subheading Font Size",
      "default": 22
    },
    {
      "type": "range",
      "id": "subheading_font_size_mobile",
      "min": 12,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Subheading Font Size (Mobile)",
      "default": 18
    },
    {
      "type": "range",
      "id": "subheading_font_weight",
      "min": 100,
      "max": 900,
      "step": 100,
      "label": "Subheading Font Weight",
      "default": 400
    },
    {
      "type": "range",
      "id": "subheading_letter_spacing",
      "min": 0,
      "max": 5,
      "step": 0.1,
      "unit": "px",
      "label": "Subheading Letter Spacing",
      "default": 0.5
    },
    {
      "type": "header",
      "content": "Countdown Timer"
    },
    {
      "type": "text",
      "id": "countdown_date",
      "label": "Countdown End Date",
      "default": "2024-11-29T23:59:59",
      "info": "Format: YYYY-MM-DDThh:mm:ss"
    },
    {
      "type": "text",
      "id": "days_label",
      "label": "Days Label",
      "default": "DAYS"
    },
    {
      "type": "text",
      "id": "hours_label",
      "label": "Hours Label",
      "default": "HOURS"
    },
    {
      "type": "text",
      "id": "minutes_label",
      "label": "Minutes Label",
      "default": "MINUTES"
    },
    {
      "type": "text",
      "id": "seconds_label",
      "label": "Seconds Label",
      "default": "SECONDS"
    },
    {
      "type": "range",
      "id": "timer_border_width",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Vertical Separator Width",
      "default": 1,
      "info": "Width of vertical lines between timer items"
    },
    {
      "type": "range",
      "id": "timer_number_font_size",
      "min": 20,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Timer Number Font Size",
      "default": 64
    },
    {
      "type": "range",
      "id": "timer_number_font_size_mobile",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Timer Number Font Size (Mobile)",
      "default": 42
    },
    {
      "type": "range",
      "id": "timer_number_font_weight",
      "min": 100,
      "max": 900,
      "step": 100,
      "label": "Timer Number Font Weight",
      "default": 700
    },
    {
      "type": "range",
      "id": "timer_label_font_weight",
      "min": 100,
      "max": 900,
      "step": 100,
      "label": "Timer Label Font Weight",
      "default": 600
    },
    {
      "type": "range",
      "id": "timer_label_letter_spacing",
      "min": 0,
      "max": 5,
      "step": 0.5,
      "unit": "px",
      "label": "Timer Label Letter Spacing",
      "default": 1
    },
    {
      "type": "select",
      "id": "timer_font_family",
      "label": "Timer Font Family",
      "options": [
        {
          "value": "inherit",
          "label": "Same as heading"
        },
        {
          "value": "'Helvetica Neue', Arial, sans-serif",
          "label": "Modern"
        },
        {
          "value": "Georgia, serif",
          "label": "Serif"
        },
        {
          "value": "'Courier New', monospace",
          "label": "Monospace"
        }
      ],
      "default": "inherit"
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Top Padding",
      "default": 40
    },
    {
      "type": "range",
      "id": "section_padding_right",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Right Padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 40
    },
    {
      "type": "range",
      "id": "section_padding_left",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Left Padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "section_margin_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Top Margin",
      "default": 0
    },
    {
      "type": "range",
      "id": "section_margin_right",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Right Margin",
      "default": 0
    },
    {
      "type": "range",
      "id": "section_margin_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Bottom Margin",
      "default": 0
    },
    {
      "type": "range",
      "id": "section_margin_left",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Left Margin",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Black Friday Countdown",
      "category": "Promotional",
      "settings": {
        "main_heading": "BLACK FRIDAY",
        "subheading": "get 20% off if you spend 120$ or more!",
        "countdown_date": "2024-11-29T23:59:59",
        "days_label": "DAYS",
        "hours_label": "HOURS",
        "minutes_label": "MINUTES",
        "seconds_label": "SECONDS",
        "overlay_opacity": 40,
        "timer_border_width": 1
      }
    }
  ]
}
{% endschema %}